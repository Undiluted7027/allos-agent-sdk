## Day 3 - November 2, 2025

### Completed
- [x] **Tool System (Phase 3)**
  - [x] **Tool Abstraction Layer:**
    - [x] Built the foundational tool system in `allos/tools/base.py`, defining `BaseTool`, `ToolParameter`, and the `ToolPermission` enum.
    - [x] A key design decision was to include the `to_provider_format()` method in `BaseTool`. This decouples the tool definitions from the provider implementations, allowing a single tool to be represented correctly for both OpenAI, Anthropic, and any future providers.
    - [x] Implemented a decorator-based `ToolRegistry` in `allos/tools/registry.py` for easy, automatic registration of any tool class.
    - [x] Wrote comprehensive unit tests (`tests/unit/test_tools.py`) validating the abstraction layer, including edge cases like `NotImplementedError` for the abstract `execute` method and `TypeError` for incorrect decorator usage.

  - [x] **Filesystem Tools:**
    - [x] Implemented `FileReadTool`, which utilizes the secure `safe_read_file` utility. It was enhanced with a `_compute_line_indices` helper and an `inclusive` parameter for more granular control over line slicing.
    - [x] Implemented `FileWriteTool`, which uses the secure `safe_write_file` utility. A key feature added was `append_mode` to allow agents to append to files (e.g., logs) instead of just overwriting them.
    - [x] Implemented `FileEditTool`, with a critical safety feature: it validates that the `find_string` is unique in the file to prevent accidental, widespread changes.
    - [x] Implemented `ListDirectoryTool`, providing flexible options for `recursive` listing and showing `show_hidden` files.
    - [x] Wrote extensive unit tests for all filesystem tools, covering success paths, error handling, and security checks against directory traversal.

  - [x] **Shell Execution Tool:**
    - [x] Implemented the `ShellExecuteTool` with a security-first approach.
    - [x] It uses `shlex.split` to prevent shell injection, avoids `shell=True`, and enforces a `timeout`.
    - [x] A blocklist (`DANGEROUS_COMMANDS`) was added as a first-line defense against destructive commands.
    - [x] Its permission is correctly set to `ASK_USER`, establishing the primary security boundary.
    - [x] Wrote a dedicated test suite (`tests/unit/test_shell_tool.py`) to validate command execution, output capturing, timeout handling, and the dangerous command blocklist.

  - [x] **Integration and Bug Fixes:**
    - [x] Fixed the critical end-user bug where the `ToolRegistry` was empty. This was resolved by adding side-effect imports in the `__init__.py` files of the `tools`, `tools/filesystem`, and `tools/execution` packages, ensuring all built-in tools are registered on import.

  - [x] **Documentation:**
    - [x] Populated `docs/guides/tools.md` to explain the usage of all new built-in tools and the permission system.
    - [x] Created `docs/guides/custom-tools.md` to guide developers in creating their own tools.
    - [x] Added `docs/contributing/adding-tools.md` for contributors.
    - [x] Completed the `docs/reference/tool-api.md` technical reference.

### In Progress
- [ ] None. Phase 3 is complete.

### Blockers
- **Resolved:**
  - **Mypy Signature Errors:** Encountered and fixed Mypy errors due to `execute` method signatures in tool implementations not matching the generic `execute(**kwargs)` signature in `BaseTool`. Refactored all tools to conform to this contract.
  - **Off-by-one Error:** An integration test revealed an off-by-one error in the `FileReadTool`'s line slicing logic, which was corrected in the test's assertion.
  - **Critical Registration Bug:** The most significant issue was discovered via end-user simulation: the `ToolRegistry` was empty because tool modules were not being imported. This was a repeat of the pattern seen with providers and was fixed by adding side-effect imports to the relevant `__init__.py` files.

### Tomorrow
- [ ] Begin Phase 4: Agent Core.

### Notes
- The "security-first" approach for the filesystem and shell tools is a core principle. Building on top of our Phase 1 `file_utils` and adding multiple layers of defense to `shell_exec` (permissions, blocklist, safe parsing) establishes a strong security posture for the MVP.
- The recurring registration bug highlights the critical importance of testing the SDK from an end-user's perspective (i.e., from a simple script that only imports top-level modules). This will be a key part of our verification process for all future phases.
- The `BaseTool` abstraction, particularly the `to_provider_format` method, is proving to be a robust design, cleanly separating the tool's logic from the specifics of how it's presented to an LLM.
